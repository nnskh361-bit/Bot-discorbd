# بوت Discord ذكي للطقطقة والمحادثات الطبيعية

## نظرة عامة
بوت Discord متطور يستخدم Google Gemini 2.0 Flash لإجراء محادثات طبيعية جداً باللهجة العراقية مع نظام طقطقة ذكي.

## المزايا الرئيسية
- **ذاكرة سياقية متقدمة**: يقرأ آخر 15 رسالة من المحادثة لفهم السياق الكامل
- **نظام إعادة المحاولة التلقائي**: retry logic مع exponential backoff لضمان عدم فشل الردود
- **معالجة أخطاء قوية**: نظام شامل لمعالجة جميع الأخطاء المحتملة مع رسائل واضحة
- **شخصية طقطقة عراقية**: ردود ذكية وسريعة البديهة باللهجة العراقية
- **منع التكرار**: نظام ذكي يتتبع الردود السابقة ويمنع تكرار نفس الإجابات
- **logging متقدم**: تسجيل كامل للأحداث والأخطاء
- **timeout handling**: معالجة انتهاء الوقت في طلبات API

## التقنيات المستخدمة
- Python 3.11
- discord.py 2.6.3
- Google Gemini 2.0 Flash Experimental
- aiohttp للعمليات غير المتزامنة
- Flask لإبقاء البوت حي
- asyncio للمعالجة غير المتزامنة المتقدمة

## كيفية الاستخدام
1. قم بمنشنة البوت في أي قناة: `@البوت مرحبا`
2. أو قم بالرد على رسالة البوت مباشرة
3. أو فعّل الطقطقة باستخدام الأوامر أدناه

## الأوامر المتاحة
- `.مسح` - مسح سياق المحادثة الحالية
- `.حالة` - عرض حالة البوت وعدد الرسائل في الذاكرة
- `.طقطق @user` - تفعيل الطقطقة على شخص معين (البوت يرد على كل رسائله)
- `.طقطق_الكل` - تفعيل الطقطقة على الجميع (البوت يرد على كل الرسائل)
- `.وقف` - إيقاف الطقطقة
- `.فحص` - فحص حالة البوت والطقطقة النشطة
- `.مساعدة` أو `.help` - عرض قائمة الأوامر

## البنية المعمارية
- `bot.py` - الملف الرئيسي للبوت مع نظام معالجة أخطاء شامل
- `keep_alive.py` - Flask server لإبقاء البوت حي
- نظام ذاكرة محلي باستخدام `defaultdict`
- معالجة الأحداث بشكل غير متزامن
- تكامل مباشر مع Google Gemini API

## نظام معالجة الأخطاء
- **Retry Logic**: 3 محاولات تلقائية مع تأخير تصاعدي
- **Timeout Handling**: 30 ثانية كحد أقصى لكل طلب
- **Error Logging**: تسجيل كامل لجميع الأخطاء
- **Fallback Messages**: رسائل خطأ واضحة ومتنوعة للمستخدم
- **Discord API Error Handling**: معالجة خاصة لأخطاء Discord API

## التغييرات الأخيرة
- 1 أكتوبر 2025: تحسينات شاملة في معالجة الأخطاء
  - إضافة نظام retry مع exponential backoff
  - تحسين الشخصية لتكون طقطقة عراقية
  - إضافة timeout handling
  - إضافة logging متقدم
  - تحسين معالجة أخطاء Discord API
  - إضافة أمر المساعدة
  - تحسين رسائل الخطأ لتكون أكثر وضوحاً وتنوعاً

## تفضيلات المستخدم
- ردود ذكية وسريعة بأسلوب الطقطقة العراقية
- تقليل الإيموجي للحد الأدنى
- استخدام اللهجة العراقية الطبيعية
- القدرة على فهم السياق الكامل للمحادثة
- عدم تكرار الردود
- معالجة قوية للأخطاء بدون رسالة "حدث خطأ" المتكررة

## متطلبات التشغيل
- `DISCORD_TOKEN`: توكن البوت من Discord Developer Portal
- `GOOGLE_API_KEY`: مفتاح API من Google AI Studio
